<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√çGNEO - CREAR PERSONAJE</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; image-rendering: pixelated; }
        @font-face { font-family: 'Determination'; src: url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap'); }
        body { background: #000000; font-family: 'Press Start 2P', monospace; color: white; padding: 20px; }
        .estrellas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }
        .estrella { position: absolute; width: 2px; height: 2px; background: white; opacity: 0; animation: parpadear 3s infinite; }
        @keyframes parpadear { 0%,100%{opacity:0} 50%{opacity:1} }
        .caja { position: relative; z-index: 10; max-width: 1000px; margin: 0 auto; background: black; border: 3px solid white; padding: 30px; }
        h1 { text-align: center; margin-bottom: 20px; color: #ffff66; }
        .seccion { border: 2px solid white; padding: 20px; margin-bottom: 30px; }
        .seccion-titulo { color: #ffff66; border-bottom: 2px solid white; padding-bottom: 10px; margin-bottom: 20px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .campo { margin-bottom: 15px; }
        .campo label { color: #7f7f7f; font-size: 0.6rem; display: block; margin-bottom: 5px; }
        .campo input, .campo select { 
            width: 100%; 
            padding: 12px; 
            background: black; 
            border: 2px solid white; 
            color: white; 
            font-family: 'Press Start 2P', monospace; 
            font-size: 0.55rem; 
        }
        .campo select option { 
            font-size: 0.5rem; 
            padding: 5px; 
            background: black; 
            color: white;
        }
        .campo select optgroup { 
            color: #ffff66; 
            font-size: 0.6rem; 
            background: black; 
        }
        .btn-enviar { background: black; border: 2px solid white; color: white; padding: 20px; width: 100%; cursor: pointer; margin-top: 20px; }
        .btn-enviar:hover { border-color: #ffff66; color: #ffff66; }
        .subir-imagen { width: 150px; height: 150px; border: 2px dashed white; margin: 0 auto 30px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .mensaje { position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%); background: black; border: 3px solid white; padding: 30px; z-index: 1000; display: none; }
        .contador { color: #ffff66; font-size: 1rem; text-align: right; margin-top: 10px; }
        .item-habilidad { border: 1px solid #444; padding: 15px; margin-bottom: 10px; }
        .nombre-habilidad { color: #ffff66; margin-bottom: 10px; font-size: 0.6rem; }
        .barra-container { display: flex; align-items: center; gap: 10px; }
        .barra-fondo { flex: 1; height: 12px; background: black; border: 2px solid white; }
        .barra-llena { height: 100%; background: #ffff66; width: 0%; }
        .btn-cantidad { width: 30px; height: 30px; background: black; border: 2px solid white; color: white; cursor: pointer; font-family: 'Press Start 2P', monospace; font-size: 0.8rem; }
        .btn-cantidad:hover { border-color: #ffff66; color: #ffff66; }
        .valor-numero { color: #ffff66; min-width: 30px; text-align: right; }
    </style>
</head>
<body>
    <div class="estrellas" id="estrellas"></div>

    <div class="caja">
        <h1>CREAR PERSONAJE</h1>
        
        <!-- IMAGEN -->
        <div class="subir-imagen" onclick="document.getElementById('file').click()">
            <p style="color: #7f7f7f;">SUBIR IMAGEN</p>
        </div>
        <input type="file" id="file" accept="image/*" style="display: none;">

        <!-- DATOS B√ÅSICOS -->
        <div class="seccion">
            <div class="seccion-titulo">DATOS B√ÅSICOS</div>
            <div class="grid-2">
                <div class="campo"><label>NOMBRE</label><input type="text" id="nombre"></div>
                <div class="campo"><label>EMAIL</label><input type="email" id="email"></div>
                <div class="campo"><label>EDAD</label><input type="number" id="edad"></div>
                <div class="campo"><label>G√âNERO</label>
                    <select id="genero">
                        <option value="">-</option>
                        <option>MASCULINO</option>
                        <option>FEMENINO</option>
                        <option>NO BINARIO</option>
                        <option>OTRO</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- RAZA Y RANGO - SELECTORES NORMALES -->
        <div class="seccion">
            <div class="seccion-titulo">RAZA Y JERARQU√çA</div>
            <div class="grid-2">
                <div class="campo"><label>RAZA / ESPECIE</label>
                    <select id="raza">
                        <option value="">SELECCIONAR RAZA</option>
                        
                        <optgroup label="‚ö° ASTRALITH-VANDERMERE">
                            <option>La criatura de las escaleras</option>
                            <option>Las hadas</option>
                            <option>El elefante de 3 cabezas</option>
                            <option>Los √°ngeles</option>
                            <option>Los animales celestiales</option>
                            <option>Los pegados</option>
                            <option>El f√©nix</option>
                            <option>Coatl</option>
                        </optgroup>
                        
                        <optgroup label="üî• NORUM DOMINAI">
                            <option>Los demonios</option>
                            <option>Los minotauros</option>
                            <option>Los basiliscos</option>
                            <option>Las g√°rgolas</option>
                            <option>Los onni</option>
                            <option>Nogitsune</option>
                            <option>Kitsune</option>
                            <option>La velas</option>
                            <option>Los banshee</option>
                            <option>El dybbuk</option>
                            <option>Los yokai</option>
                            <option>Berserk</option>
                            <option>Sabuesos del infierno</option>
                            <option>La cacer√≠a salvaje</option>
                            <option>Sucubos</option>
                        </optgroup>
                        
                        <optgroup label="üåë THANATROR">
                            <option>Centauro</option>
                            <option>Onocentauros</option>
                            <option>Los icocentauros</option>
                            <option>La quimera</option>
                            <option>Los ogros</option>
                            <option>Los orcos</option>
                            <option>Orto</option>
                            <option>Las gorgonas</option>
                            <option>Los satiros</option>
                            <option>Los hombres lobo</option>
                            <option>Los dragones</option>
                            <option>Los fenrir</option>
                            <option>Zombie</option>
                            <option>Kanima</option>
                            <option>Los trolls</option>
                            <option>Los gigantes</option>
                            <option>Cambia formas</option>
                            <option>La chupa cabras</option>
                            <option>Los genios</option>
                            <option>Moby Dick</option>
                            <option>Los coyote</option>
                            <option>Brujas</option>
                            <option>Nemeton</option>
                            <option>Druidas</option>
                            <option>Webdigos</option>
                            <option>Los darach</option>
                        </optgroup>
                        
                        <optgroup label="‚õ∞Ô∏è BALNATH">
                            <option>Los elfos</option>
                            <option>Los duendes</option>
                            <option>Los enanos</option>
                            <option>Los golems</option>
                            <option>Los gromos</option>
                            <option>Los goblins</option>
                            <option>Pixiu</option>
                        </optgroup>
                        
                        <optgroup label="üåä KAIDOM">
                            <option>Sirenas</option>
                            <option>Tifones</option>
                            <option>La hidra de lerna</option>
                            <option>Ofiotauro</option>
                            <option>La escila</option>
                            <option>Las ninfas</option>
                            <option>Mounstros del lago ness</option>
                            <option>Leviatan</option>
                            <option>El Kraken</option>
                            <option>Hipocampo</option>
                            <option>Shenlong</option>
                            <option>Megalodon</option>
                            <option>Vampiros</option>
                        </optgroup>
                    </select>
                </div>
                <div class="campo"><label>JERARQU√çA / RANGO</label>
                    <select id="rango">
                        <option value="">SELECCIONAR RANGO</option>
                        <option>Rango I: Divino</option>
                        <option>Rango II: Alta Nobleza</option>
                        <option>Rango III: Nobleza/Gobierno</option>
                        <option>Rango IV: √âlite/Protector</option>
                        <option>Rango V: Ciudadano/Guerrero</option>
                        <option>Rango VI: Com√∫n/Sirviente</option>
                        <option>Rango VII: Inferior/Exiliado</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- HABILIDADES -->
        <div class="seccion">
            <div class="seccion-titulo">HABILIDADES <span style="font-size:0.6rem;">(25 PUNTOS)</span></div>
            <div id="habilidades-container"></div>
            <div class="contador" id="contador-habilidades">25</div>
        </div>

        <!-- CUERPO -->
        <div class="seccion">
            <div class="seccion-titulo">CUERPO <span style="font-size:0.6rem;">(12 PUNTOS)</span></div>
            <div id="cuerpo-container"></div>
            <div class="contador" id="contador-cuerpo">12</div>
            <div class="campo" style="margin-top:20px;"><label>ALTURA</label><input type="text" id="altura" placeholder="ej: 1.75m"></div>
        </div>

        <!-- MENTE -->
        <div class="seccion">
            <div class="seccion-titulo">MENTE <span style="font-size:0.6rem;">(9 PUNTOS)</span></div>
            <div id="mente-container"></div>
            <div class="contador" id="contador-mente">9</div>
        </div>

        <!-- SOCIAL -->
        <div class="seccion">
            <div class="seccion-titulo">SOCIAL <span style="font-size:0.6rem;">(14 PUNTOS)</span></div>
            <div id="social-container"></div>
            <div class="contador" id="contador-social">14</div>
        </div>

        <!-- OPCIONES EXCLUSIVAS -->
        <div class="seccion">
            <div class="seccion-titulo">ELECCIONES</div>
            <div class="grid-2">
                <div class="campo"><label>HONESTO / CARI√ëOSO</label><select id="op1"><option value="">-</option><option>HONESTO</option><option>CARI√ëOSO</option></select></div>
                <div class="campo"><label>LIDER / SEGUIDOR</label><select id="op2"><option value="">-</option><option>LIDER</option><option>SEGUIDOR</option></select></div>
                <div class="campo"><label>EDUCADO / RUDO</label><select id="op3"><option value="">-</option><option>EDUCADO</option><option>RUDO</option></select></div>
                <div class="campo"><label>POL√çTICO / INDIFERENTE</label><select id="op4"><option value="">-</option><option>POL√çTICO</option><option>INDIFERENTE</option></select></div>
            </div>
        </div>

        <button class="btn-enviar" onclick="enviar()">ENVIAR SOLICITUD</button>
    </div>

    <div class="mensaje" id="mensaje"><p id="mensaje-texto"></p><button onclick="cerrarMensaje()">OK</button></div>

    <script>
        // Estrellas
        for (let i=0; i<150; i++) {
            let e = document.createElement('div');
            e.className = 'estrella';
            e.style.left = Math.random()*100+'%';
            e.style.top = Math.random()*100+'%';
            e.style.animationDelay = Math.random()*3+'s';
            document.getElementById('estrellas').appendChild(e);
        }

        // ========== DATOS ==========
        const secciones = {
            habilidades: { 
                items: ['PERSUASI√ìN','COMUNICACI√ìN','PERCEPCI√ìN','MEDITACI√ìN','ALFABETISMO','CREATIVIDAD','TECNOLOG√çA','COMBATE','SUPERVIVENCIA','COQUETA','SEDUCCI√ìN','SUERTE'], 
                valores: [0,0,0,0,0,0,0,0,0,0,0,0], 
                restante: 25, 
                max: 25 
            },
            cuerpo: { 
                items: ['DESTREZA','SALUD','ENERG√çA','BELLEZA','ESTILO'], 
                valores: [0,0,0,0,0], 
                restante: 12, 
                max: 12 
            },
            mente: { 
                items: ['INTELIGENCIA','FELICIDAD','ESPIRITUALIDAD','CONFIANZA'], 
                valores: [0,0,0,0], 
                restante: 9, 
                max: 9 
            },
            social: { 
                items: ['CARISMA','EMPAT√çA','AGRESIVIDAD','GENEROSIDAD','RIQUEZA','LIBIDO'], 
                valores: [0,0,0,0,0,0], 
                restante: 14, 
                max: 14 
            }
        };

        // ========== RENDERIZAR ==========
        function renderizar() {
            for (let sec in secciones) {
                let container = document.getElementById(sec+'-container');
                container.innerHTML = '';
                secciones[sec].items.forEach((nombre, idx) => {
                    let div = document.createElement('div');
                    div.className = 'item-habilidad';
                    div.innerHTML = `
                        <div class="nombre-habilidad">${nombre}</div>
                        <div class="barra-container">
                            <div class="barra-fondo">
                                <div class="barra-llena" id="barra-${sec}-${idx}" style="width: 0%"></div>
                            </div>
                            <span class="valor-numero" id="valor-${sec}-${idx}">0</span>
                            <button class="btn-cantidad" onclick="cambiar('${sec}',${idx},-1)">-</button>
                            <button class="btn-cantidad" onclick="cambiar('${sec}',${idx},1)">+</button>
                        </div>
                    `;
                    container.appendChild(div);
                });
                document.getElementById('contador-'+sec).textContent = secciones[sec].restante;
            }
        }

        // ========== CAMBIAR VALOR ==========
        window.cambiar = function(sec, idx, delta) {
            let s = secciones[sec];
            let nuevo = s.valores[idx] + delta;
            if (nuevo < 0 || nuevo > 5) return;
            
            if (delta > 0 && s.restante > 0) {
                s.valores[idx] = nuevo;
                s.restante--;
            } else if (delta < 0) {
                s.valores[idx] = nuevo;
                s.restante++;
            }
            
            document.getElementById(`barra-${sec}-${idx}`).style.width = (s.valores[idx]/5*100)+'%';
            document.getElementById(`valor-${sec}-${idx}`).textContent = s.valores[idx];
            document.getElementById('contador-'+sec).textContent = s.restante;
        };

        // ========== IMAGEN ==========
        let imagenData = null;
        document.getElementById('file').addEventListener('change', function(e) {
            let file = e.target.files[0];
            if (file) {
                let reader = new FileReader();
                reader.onload = function(ev) { imagenData = ev.target.result; };
                reader.readAsDataURL(file);
            }
        });

        // ========== MENSAJES ==========
        function mostrar(m) { document.getElementById('mensaje-texto').textContent = m; document.getElementById('mensaje').style.display = 'block'; }
        window.cerrarMensaje = function() { document.getElementById('mensaje').style.display = 'none'; };

        // ========== ENVIAR ==========
        window.enviar = async function() {
            let nombre = document.getElementById('nombre').value.trim();
            let email = document.getElementById('email').value.trim();
            let edad = document.getElementById('edad').value;
            let genero = document.getElementById('genero').value;
            let raza = document.getElementById('raza').value;
            let rango = document.getElementById('rango').value;
            let altura = document.getElementById('altura').value.trim();

            if (!nombre || !email || !edad || !genero || !raza || !rango || !altura) {
                mostrar('* COMPLETA TODOS LOS CAMPOS B√ÅSICOS');
                return;
            }

            if (secciones.habilidades.restante !== 0) {
                mostrar('* HABILIDADES: FALTAN '+secciones.habilidades.restante+' PUNTOS');
                return;
            }
            if (secciones.cuerpo.restante !== 0) {
                mostrar('* CUERPO: FALTAN '+secciones.cuerpo.restante+' PUNTOS');
                return;
            }
            if (secciones.mente.restante !== 0) {
                mostrar('* MENTE: FALTAN '+secciones.mente.restante+' PUNTOS');
                return;
            }
            if (secciones.social.restante !== 0) {
                mostrar('* SOCIAL: FALTAN '+secciones.social.restante+' PUNTOS');
                return;
            }

            let op1 = document.getElementById('op1').value;
            let op2 = document.getElementById('op2').value;
            let op3 = document.getElementById('op3').value;
            let op4 = document.getElementById('op4').value;
            if (!op1 || !op2 || !op3 || !op4) {
                mostrar('* SELECCIONA TODAS LAS OPCIONES EXCLUSIVAS');
                return;
            }

            function obj(sec) {
                let o = {};
                secciones[sec].items.forEach((n,i) => o[n] = secciones[sec].valores[i]);
                return o;
            }

            let data = {
                nombre: nombre,
                email: email,
                raza: raza,
                rango: rango,
                edad: parseInt(edad),
                genero: genero,
                altura: altura,
                imagen_url: imagenData || null,
                habilidades: obj('habilidades'),
                cuerpo: obj('cuerpo'),
                mente: obj('mente'),
                social: obj('social'),
                opciones_exclusivas: { 
                    opcion1: op1, 
                    opcion2: op2, 
                    opcion3: op3, 
                    opcion4: op4 
                },
                estado: 'pendiente'
            };

            mostrar('* ENVIANDO SOLICITUD...');
            
            try {
                let { error } = await supabase.from('personajes').insert([data]);
                if (error) throw error;
                mostrar('* SOLICITUD ENVIADA. LOS GUARDIANES LA REVISAR√ÅN.');
                setTimeout(() => window.location.href = 'menu.html', 2000);
            } catch(e) {
                console.error(e);
                mostrar('* ERROR AL ENVIAR. INTENTA DE NUEVO.');
            }
        };

        // ========== INICIAR ==========
        renderizar();

        // ========== SUPABASE ==========
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
        script.onload = () => {
            const { createClient } = supabase;
            window.supabase = createClient('https://iwqeikrjhyqxyduvhhkg.supabase.co', 'unsrhffwguwfebhppptz');
        };
        document.head.appendChild(script);
    </script>
</body>
</html>
